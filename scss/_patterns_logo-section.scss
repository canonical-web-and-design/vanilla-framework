@mixin vf-p-set-nested-logo-width($breakpoint: small) {
  // This mixin calculates the width of an individual logo for cases when the logo section is nested inside a container that doesn't span the full grid.

  // Settings for the small breakpoint
  $grid-column-count: $grid-columns-small;
  $grid-column-prefix: $grid-small-col-prefix;
  $gutter: map-get($grid-gutter-widths, small);
  // medium and small use the same breakpoint, but one uses a max-width, the other a min-width; so, we need to specify which one to use
  $media-query-keyword: max-width;
  $media-query-width: $threshold-4-6-col;
  // how many grid columns should a logo span
  $logo-column-span: 1;

  @if $breakpoint == medium {
    // Settings for the small breakpoint
    $grid-column-count: $grid-columns-medium;
    $grid-column-prefix: $grid-medium-col-prefix;
    $gutter: map-get($grid-gutter-widths, medium);
    $media-query-keyword: min-width;
    $media-query-width: $threshold-4-6-col;
    $logo-column-span: 1;
  } @else if $breakpoint == large {
    // Settings for the small breakpoint
    $grid-column-count: $grid-columns;
    $grid-column-prefix: $grid-large-col-prefix;
    $gutter: map-get($grid-gutter-widths, large);
    $media-query-keyword: min-width;
    $media-query-width: $threshold-6-12-col;
    $logo-column-span: 2;
  }

  @media ($media-query-keyword: #{$media-query-width}) {
    // Looping in reverse to ensure nested column rules end up further down in the generated css file, thus having higher specificity.
    // E.g. if a col-4 is nested inside col-8, the col-8 rule should be written above the col-4 rule in the css file, to ensure the correct styles apply
    @for $column-count from $grid-column-count through 1 {
      .#{$grid-column-prefix}#{$column-count} & {
        // The number of gutters is one less than the number of columns.
        // $gutters-total-width calculates the total width of all gutters
        $gutters-total-width: ($column-count - 1) * $gutter;
        @if $column-count == 1 {
          // if the available number of columns of the parent container is less than the desired number of columns the logo should span, we clamp that desired number ($logo-column-span) to what's available:
          $logo-column-span: min($logo-column-span, $column-count);
        }

        // The logos are sized so that, depending on breakpoint, they span either one, or two columns of the grid.
        // When spanning more than one column, we need to account for the gutters between the columns.

        // calc() doesn't allow dividing a mixture of different units, so the calculation
        // (100% - $gutters-total-width) / $column-count needs to be broken down into two separate divisions:
        // 100% / $column-count - $gutters-total-width / $column-count
        // Thus the calculation is split into 2 parts, which are then used in the final calc() function:

        // calculate the width of a single column by dividing the entire width by the number of columns it represents:
        $percentage-width-of-one-col: 100% / $column-count;

        // multiply the width of one column by the number of columns the logo needs to span
        $percentage-contribution: $logo-column-span * $percentage-width-of-one-col;

        // calculate the number of gutters the logo spans
        $gutter-width-inside-logo: $gutter * ($logo-column-span - 1);

        // add the width of gutters spanned by the logo, subtract the $gutters-total-width / $column-count
        $rem-contribution: $gutter-width-inside-logo - $logo-column-span * ($gutters-total-width / $column-count);

        @if $rem-contribution == 0 {
          width: $percentage-contribution;
        } @else {
          width: calc(#{$percentage-contribution} + #{$rem-contribution});
        }
      }
    }
  }
}

@mixin vf-p-logo-section {
  // The logo section pattern needs to align logos to the grid when they are an even number, and center them (while maintaining the same logo width) when the number of logos on a line is odd.
  // This means we can't use css grid for this, instead we need to replicate its behavior for even numbers of logos, and center the odd ones.

  .p-logo-section {
    @extend %fixed-width-container;

    .row &,
    .u-fixed-width & {
      @include vf-b-row-reset;
    }
  }

  .p-logo-section__title {
    @extend %x-small-text;

    font-weight: $font-weight-bold;
    text-transform: uppercase;
  }

  .p-logo-section__items {
    display: flex;
    flex-wrap: wrap;
    gap: 0 map-get($grid-gutter-widths, small);
    justify-content: center;
    width: 100%;

    @media (min-width: $threshold-4-6-col) {
      gap: 0 map-get($grid-gutter-widths, medium);
    }

    @media (min-width: $threshold-6-12-col) {
      gap: 0 map-get($grid-gutter-widths, large);
    }

    [class*='col-'] & {
      justify-content: start;
    }
  }

  .p-logo-section__item {
    $gutter--small: map-get($grid-gutter-widths, small);
    $logo-column-span--small: 1;
    $gutters-total-width--small: ($grid-columns-small - 1) * $gutter--small;

    $gutter--medium: map-get($grid-gutter-widths, medium);
    $logo-column-span--medium: 1;
    $gutters-total-width--medium: ($grid-columns-medium - 1) * $gutter--medium;

    $gutter--large: map-get($grid-gutter-widths, large);
    $logo-column-span--large: 2;
    $gutters-total-width--large: ($grid-columns - 1) * $gutter--large;

    align-items: center;
    display: flex;
    flex: 0 1 auto;
    margin-bottom: $spv-outer--scaleable;
    width: calc(
      #{$logo-column-span--small * (100% / $grid-columns-small)} - #{$logo-column-span--small * ($gutters-total-width--small / $grid-columns-small) - $gutter--small * (
          $logo-column-span--small - 1
        )}
    );

    @media (min-width: $threshold-4-6-col) {
      width: calc(
        #{$logo-column-span--medium * (100% / $grid-columns-medium)} - #{$logo-column-span--medium * ($gutters-total-width--medium / $grid-columns-medium) - $gutter--medium * (
            $logo-column-span--medium - 1
          )}
      );
    }

    @media (min-width: $threshold-6-12-col) {
      width: calc(
        #{$logo-column-span--large * (100% / $grid-columns)} - #{$logo-column-span--large * ($gutters-total-width--large / $grid-columns) - $gutter--large * (
            $logo-column-span--large - 1
          )}
      );
    }

    @include vf-p-set-nested-logo-width($breakpoint: small);
    @include vf-p-set-nested-logo-width($breakpoint: medium);
    @include vf-p-set-nested-logo-width($breakpoint: large);
  }
}
